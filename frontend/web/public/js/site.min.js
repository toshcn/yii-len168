/*! len168.com js file @author toshcn <toshcn@qq.com> 2017-03-29 */
function isGuest(){return _isGuest}function showLoginWidget(){var a=$(window).height(),b=$(document).width();$("#login-widget").show(),$("#fade-layout").show();var c=$("#login-widget").width(),d=$("#login-widget").height(),e=a>d?(a-d)/2:0,f=b>c?(b-c)/2:0;console.log([e,f]),$("#login-widget").css({top:e,left:f})}function hideLoginWidget(){$("#login-widget").hide(),$("#fade-layout").hide()}function showMessageWidget(a){var b=$(window).height(),c=$(document).width();$(a).show(),$("#fade-layout").show();var d=$(a).width(),e=$(a).height(),f=b>e?(b-e)/2:0,g=c>d?(c-d)/2:0;console.log([f,g]),$(a).css({top:f,left:g})}function hideMessageWidget(a){$(a).hide(),$("#fade-layout").hide()}function uaparser(a,b){var c=new UAParser,d=c.getOS(),e=c.getBrowser();console.log(a),console.log(b),$(a).val(d.name),$(b).val(e.name+","+e.major)}function submitLoginWidgetForm(){checkedLoginWidgetForm()&&(loginWidgetFormLoading(),loginWidgetFormRemoveErr(),uaparser('[name="LoginForm[os]"]','[name="LoginForm[browser]"]'),$.post($("#login-widget-form").prop("action"),$("#login-widget-form").serialize(),function(a){if(a=$.parseJSON(a),a.ok)window.location.reload();else if($("#error-msg").text(a.error),loginWidgetFormHasErr(),a.interval>0){$res=$("#login-widget-submit"),$res.html('(<b class="times" id="times">'+a.interval+"</b>)秒后再登录"),$id=$("#login-widget-submit > #times");var b=window.setInterval(function(){a.interval-=1,a.interval>=0&&($res.off("click.loginWidget"),$id.text(a.interval)),a.interval<=0&&(window.clearInterval(b),$res.html("登录"),$("#error-msg").text(""),$res.on("click.loginWidget",submitLoginWidgetForm))},1e3)}else $("#login-widget-submit").html("登录"),$("#login-widget-submit").on("click.loginWidget",submitLoginWidgetForm)}))}function loginWidgetFormLoading(){$("#login-widget-submit").off("click.loginWidget"),$("#login-widget-submit").html('<i class="fa fa-spinner fa-spin"></i>')}function checkedLoginWidgetForm(){var a=$('[name="LoginForm[username]"]'),b=$('[name="LoginForm[password]"]');return a.val().length<1?(a.parent().addClass("has-error"),a.focus(),!1):(console.log(b.val().length),!(b.val().length<6)||(b.parent().addClass("has-error"),b.focus(),!1))}function loginWidgetFormHasErr(){$('[name="LoginForm[username]"]').parent().addClass("has-error"),$('[name="LoginForm[password]"]').parent().addClass("has-error")}function loginWidgetFormRemoveErr(){$('[name="LoginForm[username]"]').parent().removeClass("has-error"),$('[name="LoginForm[password]"]').parent().removeClass("has-error")}function addFollowerResult(a){$.post(_addFollowerUrl,{uid:a,_csrf:_csrf},function(b){if(b=$.parseJSON(b),1==b.ok){swal({title:"结果",text:"已成功关注！",type:"success",showCancelButton:!1,confirmButtonText:"确认"}),_authorWidget[a]="";var c=$('.js-uinfo-box [name="add-follower-'+a+'"]');c.html('<i class="fa fa-minus"></i> 取消关注</button>'),c.prop("name","remove-follower-"+a)}else swal({title:"结果",text:"关注失败，请稍后再试！",type:"error",showCancelButton:!1,confirmButtonText:"确认"})})}function removeFollowerResult(a,b){$.post(_removeFollowerUrl,{uid:a,_csrf:_csrf},function(b){if(b=$.parseJSON(b),1==b.ok){swal({title:"成功",text:"已成功取消关注！",type:"success",showCancelButton:!1,confirmButtonText:"确认"}),_authorWidget[a]="";var c=$('.js-uinfo-box [name="remove-follower-'+a+'"]');c.html('<i class="fa fa-plus"></i> 关注</button>'),c.prop("name","add-follower-"+a)}else swal({title:"失败",text:"取消关注失败，请稍后再试！",type:"error",showCancelButton:!1,confirmButtonText:"确认"})})}function sendMessage(){if(!$('[name="message[content]"]').val())return $('[name="message[content]"]').focus(),!1;$("#send-message-btn").off("click.sendMessage"),$("#send-message-btn").html('<i class="fa fa-spinner fa-spin"></i>发送中'),$.post($("#message-widget-form").prop("action"),$("#message-widget-form").serialize(),function(a){a.ok?swal({title:"成功",text:"信息已发送成功！",type:"success",showCancelButton:!1,confirmButtonText:"确认"},function(){$('[name="message[content]"]').val(""),hideMessageWidget("#message-widget")}):swal({title:"失败",text:"信息发送失败！",type:"error",showCancelButton:!1,confirmButtonText:"确认"}),$("#send-message-btn").html("发送"),$("#send-message-btn").on("click.sendMessage",sendMessage)})}jQuery(function(a){function b(){document.documentElement.scrollTop=1,document.body.scrollTop=1}a(document).ready(function(){a(".timeago").timeago(),a("#backtop").on("click.backtopEvent",function(){a("body").animate({scrollTop:0},200),b()}),a("body").on("mouseenter.authorLayoutEvent",".author-widget",function(){var b=a(this).children(".author-info-box"),c=b.attr("data-author");b.css({display:"inline-table"}),_authorWidget[c]?b.html(_authorWidget[c]):a.get(_authorWidgetUrl,{id:c},function(a){a&&(_authorWidget[c]=a,b.html(a))})}).on("mouseleave.authorLayoutEvent",".author-widget",function(){a(this).children(".author-info-box").hide("fast")}),a("#login-widget-close").on("click.closeLoginWidget",function(){hideLoginWidget()}),a("#login-widget-submit").on("click.loginWidget",submitLoginWidgetForm)}),a("body").on("click.addFollower",'[name^="add-follower-"]',function(){if(isGuest())showLoginWidget();else{var b=a(this).attr("data-user");swal({title:"关注",text:"确定要关注Ta吗！",type:"success",showCancelButton:!0,confirmButtonText:"确认",cancelButtonText:"取消",closeOnConfirm:!1},function(){addFollowerResult(b),_authorWidget[b]=""})}}),a("body").on("click.removeFollower",'[name^="remove-follower-"]',function(){if(isGuest())showLoginWidget();else{var b=a(this).attr("data-user");swal({title:"取消关注",text:"确定要取消关注Ta吗！",type:"warning",showCancelButton:!0,confirmButtonText:"确认",cancelButtonText:"取消",closeOnConfirm:!1},function(){removeFollowerResult(b),_authorWidget[b]=""})}}),a("body").on("click.showMessageWidget",'[name="send-message-btn"]',function(){isGuest()?showLoginWidget():(a("#message-at").text(a(this).attr("data-at")),a("#message-to-user").val(a(this).attr("data-user")),showMessageWidget("#message-widget"))}),a('[name="message-widget-close"]').on("click.closeMessageWidget",function(){hideMessageWidget(a(this).attr("data-close"))}),a("#send-message-btn").on("click.sendMessage",sendMessage)});
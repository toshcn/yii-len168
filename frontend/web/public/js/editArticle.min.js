/*! len168.com js file @author toshcn <toshcn@qq.com> 2017-04-24 */
jQuery(function(a){a(document).ready(function(){a("#post-form").on("click",'[name="editormd-image-file"]',function(){a(this).parent().find('[name="_csrf"]').val()||a(this).parent().append('<input type="hidden" name="_csrf" value="<?= Yii::$app->request->csrfToken ?>">')}),a("#push-main-image").on("click",function(){var b=a("#search-image-items").find("li.selected").data();if(b){var c=a("#search-image-items").find("li.selected>img").prop("src");a("#privew-main-image").prop("src",c),a('[name="PostForm[image]"]').val(_imageHost+b.thumb_path+b.name),a('[name="PostForm[imageSuffix]"]').val(b.thumb_suffix+"?v="+b.version),swal({title:"提示！",text:"已设为封面图！",type:"success",confirmButtonText:"确认"})}else swal({title:"提示！",text:"请选择图片",confirmButtonText:"确认"})}),a("#search-image-items").on("click","li",function(){a("#search-image-items").find("li").removeClass("selected"),a(this).addClass("selected");var b=a(this).data(),c=a(this).children("img").attr("src");a("#priview-img").attr("src",c),a("#priview-img").data(b),a("#priview-name").text(b.name+b.suffix);var d=b.time.split("-");a("#priview-time").text(d[0]+"年"+d[1]+"月"+d[2]+"日"),a("#priview-px").text(b.width+" x "+b.height+"像素"),a("#priview-url").val(c),a("#priview-title").val(b.title),a("#priview-edit").attr("data-id",b.id),a("#priview-del").attr("data-id",b.id),a("#image-detail-box").show()}),a("#set-main-image-btn").on("click",function(){a("#search-images-btn").trigger("click"),a("#push-image-to-post").hide()}),a("#post-title").on("input",function(){var b=a(this).val().length,c=45-b;c=c>0?c:0,a("#title-len").text(c),b>0?a(this).parent().removeClass("has-error"):a(this).parent().addClass("has-error")}),a("#edit-desc").on("input",function(){var b=a(this).val().length,c=250-b;c=c>0?c:0,a("#desc-len").text(c)}),a("#post-type").on("change",function(){2==a(this).val()?a("#original-url").removeClass("hide"):a("#original-url").addClass("hide")}),a("#post-tagcloud > a").on("click.selete-post-tag",function(){var b=a(this).attr("data-tag"),c=a(this).text(),d=a("#selected-tag").find('[data-tag="'+b+'"]');if(d.text())a(this).toggleClass("cur"),d.remove(),a("#edit-post-tag").css("padding-left",a("#selected-tag").width()+8);else if(a("#selected-tag>.post-tag-seleted").length<5){var e='<label class="label label-sm label-warning post-tag-seleted" data-tag="'+b+'" title="点击删除"><input type="hidden" name="PostForm[tags][]" value="'+c+'">'+c+"</label>";a("#selected-tag").append(e),a("#edit-post-tag").css("padding-left",a("#selected-tag").width()+8),a(this).toggleClass("cur")}}),a("#selected-tag").on("click",".post-tag-seleted",function(){var b=a(this).attr("data-tag");b&&a('#post-tagcloud>[data-tag="'+b+'"]').toggleClass("cur"),a(this).remove(),a("#edit-post-tag").css("padding-left",a("#selected-tag").width()+8)}),a("#edit-post-tag").on("blur.input-post-tag",function(){var b=a(this).val().replace(/[^a-zA-Z\d\u4e00-\u9fa5\s_,，]/g,""),c=a("#selected-tag>.post-tag-seleted").length;if(b){var d=b.split(/[\s,，]/),e=5-c;a(this).val(""),a.each(d,function(b,c){if(c&&e>0){e--;var d='<label class="label label-sm label-warning post-tag-seleted" title="点击删除"><input type="hidden" name="PostForm[tags][]" value="'+c+'">'+c+"</label>";a("#selected-tag").append(d)}}),a("#edit-post-tag").css("padding-left",a("#selected-tag").width()+8)}}),a("#more-tag").on("click",function(){a(this).hasClass("more")?(a("#post-tagcloud").css("height","24"),a("#post-tagcloud").css("overflow","hidden")):(a("#post-tagcloud").css("height","auto"),a("#post-tagcloud").css("overflow","visible"));var b=a("#post-tagcloud").height()<=24?34:a("#post-tagcloud").height();a("#hot-tag-docker").css("height",b),a(this).toggleClass("orange more")}),a("#upload-image-head").on("click",function(){a("#chosen-image-bar").hide(),a("#upload-image-bar").show()}),a("#images-store-head").on("click",function(){a("#upload-image-bar").hide(),a("#chosen-image-bar").show()})});var b=editormd;b.katexURL={js:"/public/vendor/katex/dist/katex.min",css:"/public/vendor/katex/dist/katex.min"},b("word-edit",{width:"100%",height:640,toolbarIcons:function(){return["undo","redo","|","bold","del","italic","quote","ucwords","uppercase","lowercase","|","h1","h2","h3","h4","h5","h6","|","table","list-ul","list-ol","hr","|","link","reference-link","images","code","preformatted-text","datetime","emoji","html-entities","pagebreak","|","goto-line","watch","preview","fullscreen","clear","search","|","help","info"]},toolbarIconsClass:{images:"fa-file-photo-o"},lang:{toolbar:{images:"添加图片"}},toolbarHandlers:{images:function(b,c,d,e){a("#post-images").modal("show"),a("#push-image-to-post").show(),a("#search-images-btn").trigger("click"),a("#push-image-to-post").off("click.push-image-to-post"),a("#push-image-to-post").on("click.push-image-to-post",function(){var c=a("#search-image-items").find("li.selected").data();if(c){var f=_imageHost+c.path+c.name+c.suffix+"?v="+c.version,g=c.title;b.replaceSelection("!["+g+"]("+e+f+")"),""===e&&b.setCursor(d.line,d.ch+1),a("#post-images").modal("hide")}else swal({title:"提示！",text:"请选择图片",confirmButtonText:"确认"})}),console.log("testIcon =>",this,b,c,d,e)}},syncScrolling:"single",markdown:"",tex:!0,tocm:!0,emoji:!1,codeFold:!0,searchReplace:!0,htmlDecode:"style,script,iframe",flowChart:!0,sequenceDiagram:!0,imageUpload:!0,imageFormats:["jpg","jpeg","gif","png"],imageUploadURL:"./upload-img",path:"/public/vendor/editor.md/lib/",onload:function(){var b=this.getMarkdown().replace(/[^\x00-\xff]/g,"aaa").length;a("#word-len").text(b),a("#word-can-len").text(65535-b)},onchange:function(){var b=this.getMarkdown().replace(/[^\x00-\xff]/g,"aaa").length;a("#word-len").text(b),a("#word-can-len").text(65535-b)}})});